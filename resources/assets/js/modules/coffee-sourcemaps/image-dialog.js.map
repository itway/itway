{"version":3,"sources":["image-dialog.coffee"],"names":[],"mappings":"AACA;EAAA,CAAC,CAAC,OAAO,CAAC,WAAV,GACE;IAAA,CAAA,EACE;MAAA,QAAA,EAAU,CAAA,CAAE,SAAF,CAAV;MACA,MAAA,EAAQ,CAAA,CAAE,2BAAF,CADR;MAEA,UAAA,EAAY,CAAA,CAAE,cAAF,CAFZ;MAGA,UAAA,EAAY,CAAA,CAAE,cAAF,CAAiB,CAAC,IAAlB,CAAuB,QAAvB,EAAiC,gCAAjC,CAHZ;MAIA,SAAA,EAAW,CAAA,CAAE,YAAF,CAJX;MAKA,MAAA,EAAQ,CAAA,CAAE,4CAAF,CALR;MAMA,aAAA,EAAe,SAAC,GAAD,EAAM,IAAN;eACb,sBAAA,GAAyB,GAAzB,GAA+B;MADlB,CANf;KADF;IAUA,QAAA,EAAU,SAAA;AACR,UAAA;MAAA,KAAA,GAAQ;MACR,KAAK,CAAC,mBAAN,CAAA;MACA,KAAK,CAAC,iBAAN,CAAA;IAHQ,CAVV;IAeA,iBAAA,EAAmB,SAAC,IAAD,EAAO,SAAP,EAAkB,QAAlB;AAEjB,UAAA;MAAA,KAAA,GAAQ;MACR,MAAA,GAAS,IAAI;MACb,KAAA,GAAQ,IAAI;MAEZ,MAAM,CAAC,MAAP,GAAgB,SAAC,KAAD;QACd,KAAK,CAAC,GAAN,GAAY,KAAK,CAAC,MAAM,CAAC;QAGzB,KAAK,CAAC,MAAN,GAAe,SAAA;AACb,cAAA;UAAA,CAAA,GAAI,IAAC,CAAA;UACL,CAAA,GAAI,IAAC,CAAA;UACL,CAAA,GAAI,IAAI,CAAC;UACT,CAAA,GAAI,IAAI,CAAC;UACT,CAAA,GAAI,CAAE,CAAC,CAAC,IAAI,CAAC,IAAL,GAAY,IAAb,CAAH,GAAwB;UAC5B,UAAA,GAAa,QAAQ,CAAC;UACtB,KAAK,CAAC,CAAC,CAAC,UAAU,CAAC,MAAnB,CAA0B,KAAK,CAAC,CAAC,CAAC,aAAR,CAAsB,KAAK,CAAC,GAA5B,EAAiC,CAAC,CAAC,OAAF,CAAU,CAAV,CAAjC,CAA1B;UACA,KAAK,CAAC,mBAAN,CAA0B,CAA1B,EAA6B,SAA7B;QARa;QAWf,KAAK,CAAC,OAAN,GAAgB,SAAA;UACd,KAAA,CAAM,qBAAA,GAAwB,IAAI,CAAC,IAAnC;UACA,KAAK,CAAC,mBAAN,CAA0B,IAAI,CAAC,IAA/B,EAAqC,OAArC;UACA,SAAS,CAAC,GAAV,CAAc,IAAd;QAHc;MAfF;MAuBhB,MAAM,CAAC,aAAP,CAAqB,IAArB;IA7BiB,CAfnB;IA8CA,iBAAA,EAAmB,SAAA;AACjB,UAAA;MAAA,KAAA,GAAQ;MACR,IAAG,KAAK,CAAC,CAAC,CAAC,UAAU,CAAC,IAAnB,CAAwB,KAAxB,CAA8B,CAAC,MAA/B,IAAyC,CAA5C;QACE,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC,QAAlB,CAA2B,UAA3B;eACA,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAjB,CAAyB,gEAAzB,EAFF;OAAA,MAAA;QAIE,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC,WAAlB,CAA8B,UAA9B;eACA,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAjB,CAAsB,QAAtB,CAA+B,CAAC,MAAhC,CAAA,EALF;;IAFiB,CA9CnB;IAuDA,YAAA,EAAc,SAAA;AACZ,UAAA;MAAA,KAAA,GAAQ;MACR,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAjB,CAAsB,QAAtB,CAA+B,CAAC,MAAhC,CAAA;MACA,IAAG,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,QAAf,CAAwB,UAAxB,CAAH;eACE,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,OAAjB,CAAyB,gEAAzB,EADF;OAAA,MAAA;eAEK,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,IAAjB,CAAsB,QAAtB,CAA+B,CAAC,MAAhC,CAAA,EAFL;;IAHY,CAvDd;IA6DA,mBAAA,EAAqB,SAAC,QAAD,EAAW,OAAX;AACnB,UAAA;MAAA,KAAA,GAAQ;MACR,SAAA,GAAY,CAAA,CAAE,YAAF;MACZ,IAAG,SAAS,CAAC,IAAV,CAAe,gBAAf,CAAgC,CAAC,MAAjC,GAA0C,CAA1C,IAA+C,SAAS,CAAC,IAAV,CAAe,eAAf,CAA+B,CAAC,MAAhC,GAAyC,CAA3F;QACE,SAAS,CAAC,IAAV,CAAe,iCAAf,CAAiD,CAAC,MAAlD,CAAA;QACA,SAAS,CAAC,IAAV,CAAe,eAAf,CAA+B,CAAC,MAAhC,CAAA,EAFF;;MAIA,IAAG,OAAA,KAAW,SAAd;eACE,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC,QAAlB,CAA2B,UAA3B,EADF;OAAA,MAAA;QAGE,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC,WAAlB,CAA8B,UAA9B;eACA,KAAK,CAAC,CAAC,CAAC,SAAS,CAAC,MAAlB,CAAyB,CAAA,CAAE,KAAF,CAAQ,CAAC,QAAT,CAAkB,aAAlB,CAAgC,CAAC,IAAjC,CAAsC,qBAAtC,CAA4D,CAAC,GAA7D,CAAiE;UACxF,WAAA,EAAa,MAD2E;UAExF,SAAA,EAAW,OAF6E;UAGxF,aAAA,EAAe,QAHyE;UAIxF,YAAA,EAAc,QAJ0E;SAAjE,CAAzB,EAJF;;IAPmB,CA7DrB;IA6EA,YAAA,EAAc,SAAC,KAAD;AACZ,UAAA;MAAA,KAAA,GAAQ;aACR,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,EAAf,CAAkB,OAAlB,EAA2B,SAAC,CAAD;AACzB,YAAA;QAAA,IAAG,CAAA,CAAE,+BAAF,CAAkC,CAAC,MAAnC,GAA4C,CAA/C;UACE,QAAA,GAAW,KAAK,CAAC,IAAN,CAAW,eAAX,EAA4B,aAA5B;UACX,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAjB,CAAuB,QAAvB,EAFF;SAAA,MAAA;UAIE,CAAA,CAAE,+BAAF,CAAkC,CAAC,MAAnC,CAAA;UACA,QAAA,GAAW,KAAK,CAAC,IAAN,CAAW,eAAX,EAA4B,aAA5B;UACX,KAAK,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAjB,CAAuB,QAAvB,EANF;;QAOA,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,QAAf,CAAwB,UAAxB;eACA,KAAK,CAAC,YAAN,CAAA;MATyB,CAA3B;IAFY,CA7Ed;IAyFA,mBAAA,EAAqB,SAAA;AACnB,UAAA;MAAA,KAAA,GAAQ;MACR,QAAA,GACE;QAAA,cAAA,EAAgB,GAAhB;QACA,kBAAA,EAAoB,MADpB;QAEA,gBAAA,EAAkB,gBAFlB;QAGA,gBAAA,EAAkB,4BAHlB;QAIA,UAAA,EAAY,EAJZ;QAKA,eAAA,EAAiB,oBALjB;QAMA,kBAAA,EAAoB,MANpB;QAOA,WAAA,EAAa,sDAPb;;MAUF,KAAK,CAAC,CAAC,CAAC,UAAU,CAAC,MAAnB,CAA0B,SAAC,CAAD;AACxB,YAAA;QAAA,KAAK,CAAC,CAAC,CAAC,UAAU,CAAC,IAAnB,CAAwB,EAAxB;QACA,IAAG,IAAC,CAAA,QAAJ;AACE,iBAAO,KAAA,CAAM,4BAAN,EADT;;QAEA,CAAA,GAAI,IAAC,CAAA;QACL,IAAG,CAAA,IAAM,CAAE,CAAA,CAAA,CAAX;UACE,CAAA,GAAI;AACJ,iBAAM,CAAA,GAAI,CAAC,CAAC,MAAZ;YACE,IAAG,CAAE,CAAA,CAAA,CAAE,CAAC,IAAI,CAAC,KAAV,CAAgB,SAAhB,CAAH;cACE,KAAK,CAAC,iBAAN,CAAwB,CAAE,CAAA,CAAA,CAA1B,EAA8B,KAAK,CAAC,CAAC,CAAC,UAAtC,EAAkD,QAAlD;cACA,KAAK,CAAC,YAAN,CAAmB,CAAA,CAAE,CAAC,CAAC,MAAJ,CAAnB,EAFF;aAAA,MAAA;cAIE,KAAK,CAAC,mBAAN,CAA0B,CAAE,CAAA,CAAA,CAAE,CAAC,IAA/B,EAAqC,OAArC;cACA,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,WAAf,CAA2B,UAA3B,EALF;;YAMA,CAAA;UAPF,CAFF;;MALwB,CAA1B;IAbmB,CAzFrB;;;EAyHF,CAAC,CAAC,OAAO,CAAC,WAAW,CAAC,QAAtB,CAAA;AA1HA","file":"../image-dialog.js","sourcesContent":["# generate images live rendering\r\n$.ItwayIO.imageDialog =\r\n  o:\r\n    addonBtn: $(\"a.photo\")\r\n    dialog: $(\"[data-remodal-id='photo']\")\r\n    photoBlock: $(\".photo-block\")\r\n    photoinput: $('#photoUpload').attr('accept', 'image/jpeg,image/png,image/gif')\r\n    fileLabel: $(\".filelabel\")\r\n    button: $(\"[data-remodal-id='photo'] .remodal-confirm\")\r\n    templateImage: (src, size) ->\r\n      '<img class=\"\" src=\\'' + src + '\\' />'\r\n\r\n  activate: ->\r\n    _this = this\r\n    _this.initiateDialogImage()\r\n    _this.findImageifExists()\r\n    return\r\n  renderDialogImage: (file, fileinput, settings) ->\r\n# generate a new FileReader object\r\n    _this = this\r\n    reader = new FileReader\r\n    image = new Image\r\n\r\n    reader.onload = (_file) ->\r\n      image.src = _file.target.result\r\n      # url.createObjectURL(file);\r\n\r\n      image.onload = ->\r\n        w = @width\r\n        h = @height\r\n        t = file.type\r\n        n = file.name\r\n        s = ~ ~(file.size / 1024) / 1024\r\n        scaleWidth = settings.thumbnail_size\r\n        _this.o.photoBlock.append _this.o.templateImage image.src, s.toFixed(2)\r\n        _this.renderLabelFileName n, 'success'\r\n        return\r\n\r\n      image.onerror = ->\r\n        alert 'Invalid file type: ' + file.type\r\n        _this.renderLabelFileName file.name, \"error\"\r\n        fileinput.val null\r\n        return\r\n\r\n      return\r\n\r\n    reader.readAsDataURL file\r\n    return\r\n  findImageifExists: ->\r\n    _this = this\r\n    if _this.o.photoBlock.find(\"img\").length >= 1\r\n      _this.o.fileLabel.addClass 'hasImage'\r\n      _this.o.addonBtn.prepend(\"<span class='addon'><b class='text-danger'>+1</b> added</span>\")\r\n    else\r\n      _this.o.fileLabel.removeClass 'hasImage'\r\n      _this.o.addonBtn.find(\".addon\").remove()\r\n\r\n  resolveAddon: ->\r\n    _this = this\r\n    _this.o.addonBtn.find(\".addon\").remove()\r\n    if _this.o.dialog.hasClass \"approved\"\r\n      _this.o.addonBtn.prepend(\"<span class='addon'><b class='text-danger'>+1</b> added</span>\")\r\n    else _this.o.addonBtn.find(\".addon\").remove()\r\n  renderLabelFileName: (filename, message)->\r\n    _this = this\r\n    fileLabel = $('.filelabel')\r\n    if fileLabel.find(\"i.text-success\").length > 0 || fileLabel.find(\"i.text-danger\").length > 0\r\n      fileLabel.find(\"i.text-success.icon-expand_more\").remove()\r\n      fileLabel.find(\"i.text-danger\").remove()\r\n\r\n    if message == \"success\"\r\n      _this.o.fileLabel.addClass 'hasImage'\r\n    else\r\n      _this.o.fileLabel.removeClass 'hasImage'\r\n      _this.o.fileLabel.append $('<i>').addClass('text-danger').text(\"format is not valid\").css({\r\n        'font-size': '14px'\r\n        'display': 'block'\r\n        'font-weight': 'normal'\r\n        'font-style': 'normal'})\r\n  confirmImage: (input) ->\r\n    _this = this\r\n    _this.o.button.on \"click\", (e) ->\r\n      if $(\"[data-photo-id='photo-input']\").length < 1\r\n        newInput = input.attr \"data-photo-id\", \"photo-input\"\r\n        _this.o.addonBtn.after newInput\r\n      else\r\n        $(\"[data-photo-id='photo-input']\").remove()\r\n        newInput = input.attr \"data-photo-id\", \"photo-input\"\r\n        _this.o.addonBtn.after newInput\r\n      _this.o.dialog.addClass \"approved\"\r\n      _this.resolveAddon()\r\n  initiateDialogImage: ->\r\n    _this = this\r\n    settings =\r\n      thumbnail_size: 460\r\n      thumbnail_bg_color: '#ddd'\r\n      thumbnail_border: '1px solid #fff'\r\n      thumbnail_shadow: '0 0 0px rgba(0, 0, 0, 0.5)'\r\n      label_text: ''\r\n      warning_message: 'Not an image file.'\r\n      warning_text_color: '#f00'\r\n      input_class: 'custom-file-input button button-primary button-block'\r\n    # when the file is read it triggers the onload event above.\r\n    # handle input changes\r\n    _this.o.photoinput.change (e) ->\r\n      _this.o.photoBlock.html ''\r\n      if @disabled\r\n        return alert('File upload not supported!')\r\n      F = @files\r\n      if F and F[0]\r\n        i = 0\r\n        while i < F.length\r\n          if F[i].type.match('image.*')\r\n            _this.renderDialogImage F[i], _this.o.photoinput, settings\r\n            _this.confirmImage $(e.target)\r\n          else\r\n            _this.renderLabelFileName F[i].name, \"error\"\r\n            _this.o.dialog.removeClass \"approved\"\r\n          i++\r\n      return\r\n    return\r\n\r\n\r\n$.ItwayIO.imageDialog.activate()\r\n"]}